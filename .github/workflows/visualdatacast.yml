name: VisualDataCast Transcode

on:
  workflow_dispatch:
    inputs:
      invid:
        description: Input video path (relative to repo)
        required: true
      injson:
        description: Diagnostics JSON path (relative to repo)
        required: true
      outdir:
        description: Output directory
        required: false
        default: visualdatacast-out

jobs:
  transcode:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install ffmpeg
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg

      - name: Ensure script is executable
        run: |
          chmod +x tools/visual-debug/build-report.sh || true

      - name: Run VisualDataCast report
        env:
          INVID: ${{ github.event.inputs.invid }}
          INJSON: ${{ github.event.inputs.injson }}
          OUTDIR: ${{ github.event.inputs.outdir }}
        run: |
          bash tools/visual-debug/build-report.sh "$INVID" "$INJSON" "$OUTDIR"

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: visualdatacast-${{ github.run_id }}
          path: ${{ github.event.inputs.outdir }}
name: VisualDataCast smoke

on:
  workflow_dispatch: {}

jobs:
  smoke:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Install deps
        run: |
          cd tools/visualdatacast
          npm init -y >/dev/null 2>&1 || true
          npm i express multer body-parser
      - name: Node lint (basic)
        run: |
          node -e "require('fs').accessSync('tools/visualdatacast/server.js')"
      - name: Print hint
        run: |
          echo "VisualDataCast files present. Run locally:"
          echo "  node tools/visualdatacast/server.js"


